var placesResponse,clickedPark,geocodeResponse,latitude,longitude,weatherObservation,weatherForecast,trails,recentSearch=[],config={apiKey:"AIzaSyDCG4DjukKJW_yQ-nGvC1UnF2Q8f6hzP_w",authDomain:"not-used-for-hw.firebaseapp.com",databaseURL:"https://not-used-for-hw.firebaseio.com",projectId:"not-used-for-hw",storageBucket:"not-used-for-hw.appspot.com",messagingSenderId:"532977520995"};firebase.initializeApp(config);var dataRef=firebase.database();
dataRef.ref().orderByChild("dateAdded").limitToLast(4).on("child_added",function(a){console.log(a.val());var f=a.val().name,e=a.val().lat;a=a.val().lng;recentSearch.push(f);var b=$("<span>");b.addClass("nav-item nav-link oswald recentSearches");b.attr("data-lat",e);b.attr("data-lng",a);b.attr("data-name",f);b.text(f);$(".navbar-nav").append(b)});
var emptyCardsAndParks=function(){$("#cardsHere").empty();$("#sampleParks").empty();var a=$("<h2>");a.addClass("fredericka");a.html("<br>Points of Interest<br>");$("#cardsHere").append(a)},placesTextSearch=function(a,f){var e=$("#destinationSearch").val();$.ajax({url:"https://maps.googleapis.com/maps/api/place/textsearch/json?query="+e+"&key=AIzaSyD6-UaTdmfPpw2x9P0Hf66Rl2XdzCwJvOQ&type="+a,method:"GET"}).then(function(a){console.log(a);placesResponse=a;for(a=0;a<f;a++){var b=$("<div>");b.addClass("card col-md-3 ml-3 mr-3 mb-3 pt-3 attraction");
b.attr("style","width: 18rem;");b.attr("data-id",placesResponse.results[a].id);b.attr("data-lat",placesResponse.results[a].geometry.location.lat);b.attr("data-lng",placesResponse.results[a].geometry.location.lng);b.attr("data-name",placesResponse.results[a].name);var d=$("<div>");d.addClass("card-body");var e=$("<img>");e.addClass("card-img-top");e.attr("src","https://maps.googleapis.com/maps/api/place/photo?maxwidth=350&photoreference="+placesResponse.results[a].photos[0].photo_reference+"&key=AIzaSyD6-UaTdmfPpw2x9P0Hf66Rl2XdzCwJvOQ");
e.attr("alt",placesResponse.results[a].name);var g=$("<h5>");g.addClass("card-title fredericka");g.text(placesResponse.results[a].name);d.append(g);b.append(e);b.append(d);$("#cardsHere").append(b)}})};
(function(){var a=[].slice,f=window.location.protocol+"//"+window.location.host,e=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(){var b=a.call(arguments),c=/^https?:\/\/([^\/]+)/i.exec(b[1]);c&&c[0].toLowerCase()!==f&&"cors-anywhere.herokuapp.com"!==c[1]&&(b[1]="https://cors-anywhere.herokuapp.com/"+b[1]);return e.apply(this,b)}})();
$(document).on("click",".park-button",function(a){a.preventDefault();clickedPark=$(this).data("park");console.log(clickedPark);$("#destinationSearch").val(clickedPark);geolocateThenWeatherSearch();emptyCardsAndParks();placesTextSearch("campground",6);setTimeout(function(){placesTextSearch("parking",2)},1E3);window.scrollTo(0,620);map.panTo(new google.maps.LatLng($(this).data("lat"),$(this).data("lng")));map.setZoom(10);markers.forEach(function(a){a.setMap(null)});markers=[];markers.push(new google.maps.Marker({position:{lat:$(this).data("lat"),
lng:$(this).data("lng")},map:map,title:$(this).data("park")}))});
$(document).on("click",".recentSearches",function(a){clickedPark=$(this).data("name");console.log(clickedPark);$("#destinationSearch").val(clickedPark);geolocateThenWeatherSearch();emptyCardsAndParks();placesTextSearch("campground",6);setTimeout(function(){placesTextSearch("parking",2)},1E3);window.scrollTo(0,620);map.panTo(new google.maps.LatLng($(this).data("lat"),$(this).data("lng")));map.setZoom(10);markers.forEach(function(a){a.setMap(null)});markers=[];markers.push(new google.maps.Marker({position:{lat:$(this).data("lat"),
lng:$(this).data("lng")},map:map,title:$(this).data("park")}))});$(document).on("click",".attraction",function(a){window.scrollTo(0,620);map.panTo(new google.maps.LatLng($(this).data("lat"),$(this).data("lng")));map.setZoom(15);markers.forEach(function(a){a.setMap(null)});markers=[];markers.push(new google.maps.Marker({position:{lat:$(this).data("lat"),lng:$(this).data("lng")},map:map,title:$(this).data("name")}))});
var renderTrail=function(){$("#trails").empty();var a=$("<h2>");a.addClass("fredericka");a.html("<br>Closest Hiking Trails<br>");$("#trails").append(a);for(a=0;a<trails.length;a++){var f=$("<div>");f.addClass("card col-md-3 ml-3 mr-3 mb-3 pt-3 suggested-trail");f.attr("style","width: 18rem;");var e=$("<div>");e.addClass("card-body");var b=$("<img>");b.addClass("card-img-top");b.attr("src",trails[a].imgSmallMed);b.attr("alt",trails[a].name);var c=$("<h5>");c.addClass("card-title fredericka");c.text(trails[a].name);
var d=$("<p>");d.addClass("card-text oswald");d.html("<br>Location: "+trails[a].location);var h=$("<p>");h.addClass("card-text oswald");h.html("<br>Total distance: "+trails[a].length+" miles");var g=$("<p>");g.addClass("card-text oswald");g.html("<br>Elevation: "+trails[a].ascent+" feet");var k=$("<p>");k.addClass("card-text oswald");k.html("<br>Average Rating: "+trails[a].stars+" stars/5 ("+trails[a].starVotes+" ratings)");var l=$("<p>");l.addClass("card-text oswald");l.html("<br>"+trails[a].summary);
k.append(l);g.append(k);h.append(g);d.append(h);c.append(d);e.append(c);f.append(b);f.append(e);$("#trails").append(f)}},renderSuggestedGearCards=function(a){for(var f=0;f<a.length;f++){var e=$("<div>");e.addClass("card col-md-3 ml-3 mr-3 mb-3 pt-3 suggested-gear");e.attr("style","width: 18rem;");var b=$("<div>");b.addClass("card-body");var c=$("<img>");c.addClass("card-img-top");c.attr("src",a[f].src);c.attr("alt",a[f].name);var d=$("<h4>");d.addClass("card-title fredericka");d.text(a[f].name);var h=
$("<div>"),g=$("<a>");g.addClass("btn btn-success oswald mb-4");g.attr("href",a[f].href);g.attr("target","_blank");g.text("Show me my options!");h.append(g);b.append(d);e.append(c);e.append(b);e.append(h);$("#gearDiv").append(e)}},renderSuggestedGear=function(){var a=[{name:"Camelbak",src:"assets/images/hot/camelbak.jpg",href:"https://www.amazon.com/s/ref=nb_sb_noss?field-keywords=camelbak"},{name:"Cooler",src:"assets/images/hot/cooler.jpg",href:"https://www.amazon.com/s/ref=nb_sb_noss_1?field-keywords=camping+coolers"},
{name:"Sun hats",src:"assets/images/hot/sunhat.jpg",href:"https://www.amazon.com/s/ref=nb_sb_noss?field-keywords=sun+hat"},{name:"Portable fan and spraybottle",src:"assets/images/hot/waterfan.jpg",href:"https://www.amazon.com/s/ref=nb_sb_noss?field-keywords=water+fan"}],f=[{name:"Instant heat handwarmer",src:"assets/images/cold/instantheat.jpg",href:"https://www.amazon.com/s/ref=nb_sb_noss?field-keywords=instant+heat+pack"},{name:"Jacket",src:"assets/images/cold/jacket.jpg",href:"https://www.amazon.com/s/ref=nb_sb_noss?field-keywords=cold+weather+jacket"},
{name:"Cold weather sleeping bag",src:"assets/images/cold/sleepingbag.jpg",href:"https://www.amazon.com/s/ref=nb_sb_noss?field-keywords=sleeping+bag"},{name:"Gloves",src:"assets/images/cold/snowgloves.jpg",href:"https://www.amazon.com/s/ref=nb_sb_noss?field-keywords=cold+weather+gloves"},{name:"Sweater",src:"assets/images/cold/sweater.jpg",href:"https://www.amazon.com/s/ref=nb_sb_noss?field-keywords=outdoor+sweater"}],e=[{name:"Boots",src:"assets/images/regulartemp/boot.jpg",href:"https://www.amazon.com/s/ref=nb_sb_noss?field-keywords=hiking+boots"},
{name:"Water bottle",src:"assets/images/regulartemp/bottle.jpg",href:"https://www.amazon.com/s/ref=nb_sb_noss?field-keywords=reusable+water+bottle"},{name:"Bug spray",src:"assets/images/regulartemp/bugspray.jpg",href:"https://www.amazon.com/s/ref=nb_sb_noss?field-keywords=bug+spray"},{name:"First aid kit",src:"assets/images/regulartemp/firstaid.jpg",href:"https://www.amazon.com/s/ref=nb_sb_noss?field-keywords=first+aid"}];$("#gear").empty();var b=$("<div>");b.addClass("row text-center mt-3 mb-3");
var c=$("<div>");c.addClass("col-md");var d=$("<h2>");d.addClass("fredericka");d.text("Suggested gear");c.append(d);b.append(c);$("#gear").append(b);b=$("<div>");b.addClass("row justify-content-center text-center");b.attr("id","gearDiv");$("#gear").append(b);30<weatherObservation.temp_c?renderSuggestedGearCards(a):10>weatherObservation.temp_c?renderSuggestedGearCards(f):renderSuggestedGearCards(e)},renderWeather=function(){$("#weather").empty();var a=$("<div>");a.addClass("row text-center mt-3 mb-4");
var f=$("<div>");f.addClass("col-md");var e=$("<h2>");e.addClass("fredericka");e.text("Weather");f.append(e);a.append(f);$("#weather").append(a);a=$("<div>");a.addClass("row justify-content-center mx-auto oswald");f=$("<div>");f.addClass("col-md-12 justify-content-center mx-auto mb-3");e=$("<div>");e.addClass("card mx-auto");e.attr("style","width: 26rem;");var b=$("<div>");b.addClass("card-header text-center");var c=$("<h3>");c.text($("#destinationSearch").val());c.addClass("oswald");var d=$("<img>");
d.attr("alt",weatherObservation.icon);d.attr("src",weatherObservation.icon_url);c.append("<br>Current conditions ");c.append(d);b.append(c);e.append(b);d=$("<ul>");d.addClass("list-group list-group-flush");b=$("<li>");b.addClass("list-group-item");b.text("Weather: "+weatherObservation.weather);d.append(b);b=$("<li>");b.addClass("list-group-item");b.text("Temperature: "+weatherObservation.temperature_string);d.append(b);b=$("<li>");b.addClass("list-group-item");b.text("Feels like: "+weatherObservation.feelslike_string);
d.append(b);b=$("<li>");b.addClass("list-group-item");b.text("Wind: "+weatherObservation.wind_string);d.append(b);e.append(d);f.append(e);a.append(f);$("#weather").append(a);a=$("<div>");a.addClass("row mt-3");f=$("<div>");f.addClass("col-md-8 mx-auto justify-content-center");e=$("<table>");e.addClass("table table-striped");d=$("<thead>");b=$("<tr>");c=$("<th>");c.attr("scope","col");c.text("Day");b.append(c);c=$("<th>");c.addClass("text-center");c.attr("scope","col");c.attr("colspan",2);c.text("Forecasted Conditions");
b.append(c);d.append(b);e.append(d);b=$("<tbody>");for(c=0;c<weatherForecast.txt_forecast.forecastday.length;c++){var h=$("<tr>");d=$("<td>");d.text(weatherForecast.txt_forecast.forecastday[c].title);h.append(d);var g=$("<td>");d=$("<img>");d.attr("alt",weatherForecast.txt_forecast.forecastday[c].icon);d.attr("src",weatherForecast.txt_forecast.forecastday[c].icon_url);g.append(d);h.append(g);d=$("<td>");d.text(weatherForecast.txt_forecast.forecastday[c].fcttext);h.append(d);b.append(h)}e.append(b);
f.append(e);a.append(f);$("#weather").append(a);renderSuggestedGear()},trailSearch=function(){$.ajax({url:"https://www.hikingproject.com/data/get-trails?lat="+latitude+"&lon="+longitude+"&maxDistance=10&key=200268815-4f75cb4511228bcd2861fe407fc89421",method:"GET"}).then(function(a){console.log(a);trails=a.trails;renderTrail()})},weatherSearch=function(){$.ajax({url:"https://api.wunderground.com/api/a44fd7abe0ac90f0/forecast/geolookup/conditions/q/"+latitude+","+longitude+".json",method:"GET"}).then(function(a){console.log(a);
weatherObservation=a.current_observation;weatherForecast=a.forecast;renderWeather()})},geolocateThenWeatherSearch=function(){var a=$("#destinationSearch").val();$.ajax({url:"https://maps.googleapis.com/maps/api/geocode/json?address="+a+"&key=AIzaSyD6-UaTdmfPpw2x9P0Hf66Rl2XdzCwJvOQ",method:"GET"}).then(function(f){geocodeResponse=f;latitude=geocodeResponse.results[0].geometry.location.lat.toFixed(2);longitude=geocodeResponse.results[0].geometry.location.lng.toFixed(2);weatherSearch();trailSearch();
-1===recentSearch.indexOf(a)?dataRef.ref().push({name:a,lat:latitude,lng:longitude,dateAdded:firebase.database.ServerValue.TIMESTAMP}):console.log("Not pushing this search into Firebase, as it is a duplicate.")})};
document.getElementById("destinationSearch").onkeypress=function(a){if(13==a.keyCode||13==a.which)""===document.getElementById("destinationSearch").value?document.getElementById("errorMsg").textContent="Don't just leave the search box blank.  Type something in!":(document.getElementById("errorMsg").textContent="",geolocateThenWeatherSearch(),emptyCardsAndParks(),placesTextSearch("campground",6),setTimeout(function(){placesTextSearch("parking",2)},1E3))};